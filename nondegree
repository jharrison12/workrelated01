#
# File to open an excel document, read the courses taken and determine whether someone is in fact
# a non-degree completer
#Created by Jonathan Harrison on 2/23/2016

import openpyxl, os, logging

logging.basicConfig(level=logging.DEBUG, format=' %(asctime)s - %(levelname)s- %(message)s')

os.chdir("M:\Assessment (New)")

wb = openpyxl.load_workbook("Working Document for Certificate Completion.xlsx")
logging.debug("Has opened excel")

#ToDO go through each name in the Nondegree spreadsheet and
#add the students program to a dictionary that equals
#the variable names of the classes they need
#to finish a program

nonDegreeStudents = wb.get_sheet_by_name("NonDegree")
#Dictionary that will contain the L# and the program
studentprogram = {}


#TODO add all non-degree programs courses
ellEndorsementCourses = [5053, 5043, 5013, 5033]

#Create the dict with the L# (key) and program(value)
for row in range(1, nonDegreeStudents.get_highest_row()+1):
    lnumber = nonDegreeStudents['G' + str(row)].value
    program = nonDegreeStudents['AA' + str(row)].value
    studentprogram[lnumber] = program

print(studentprogram)

def checkcompleter(lnumbersheet, program, lnumber):
    logging.debug("In check completer function")
    studentClassesTaken = []
    for i in range(1, lnumbersheet.get_highest_row() + 1):
        if lnumbersheet.cell(row=i, column=4).value in program:
            studentClassesTaken.append(lnumbersheet.cell(row=i, column=4).value)
        else:
            continue
    print(studentClassesTaken, program,)

    if set(program) == set(studentClassesTaken):
        #Update dictionary to replace program with "completer"
        studentprogram[lnumber] = "Completer"
        #iterate over nonDegreeStudents and update the Completer? Column
        for rownum in range(2, nonDegreeStudents.get_highest_row()):
            studentlnumber = nonDegreeStudents.cell(row=rownum, column=7).value
            if lnumber in studentprogram:
                nonDegreeStudents.cell(row=rownum, column=6).value = studentprogram[lnumber]
            else:
                continue
    else:
        studentprogram[lnumber] = "Not a completer"
        for rownum in range(2, nonDegreeStudents.get_highest_row()):
            studentlnumber = nonDegreeStudents.cell(row=rownum, column=7).value
            if lnumber in studentprogram:
                nonDegreeStudents.cell(row=rownum, column=6).value = studentprogram[lnumber]
            else:
                continue

try:
    logging.debug("In try, except statement")
    for key,val in studentprogram.items():
        try:
            lnumbersheet = wb.get_sheet_by_name(key)
            print(lnumbersheet, ellEndorsementCourses, key)
            checkcompleter(lnumbersheet,ellEndorsementCourses,key)
            logging.debug("Function exited")
            wb.save('WorkingDoc.xlsx')
        except:
            pass
except:
    pass


"""
    for row in range(1, nonDegreeStudents.get_highest_row() +1):
        lnumber = nonDegreeStudents.cell(row=row, column=7).value
        lnumbersheet = wb.get_sheet_by_name(studentprogram[lnumber])
        print(lnumbersheet)
        checkcompleter(lnumbersheet, studentprogram[lnumber],lnumber)

for rowNum in range(2, sheet.get_highest_row()):  # skip the first row
     produceName = sheet.cell(row=rowNum, column=1).value
     if produceName in PRICE_UPDATES:
         sheet.cell(row=rowNum, column=2).value = PRICE_UPDATES[produceName]

 wb.save('updatedProduceSales.xlsx')"""

